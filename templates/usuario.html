<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Reserva de Asientos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <header>
    <h1>✈️ Sistema de Reserva de Asientos</h1>
  </header>

  <main>
    <form id="formReserva" method="POST" action="/reservar">
      <input type="hidden" name="vuelo" value="vuelo_123">

      <div class="form-group">
        <label for="nombre">Nombre:</label>
        <input type="text" name="nombre" id="nombre" required placeholder="Ingresa tu nombre">
      </div>

      <div id="asientos" class="asientos-grid"></div>
      <input type="hidden" name="asiento" id="asientoSeleccionado">

      <button type="submit" class="btn-reservar">Reservar Asiento</button>
    </form>
  </main>

  <script>
    fetch("/consultar")
      .then(res => res.json())
      .then(data => {
        const asientos = data["vuelo_123"].asientos;
        let html = "";
        for (let asiento in asientos) {
          const ocupado = asientos[asiento];
          html += `
            <button type="button"
                    class="asiento ${ocupado ? 'ocupado' : 'libre'}"
                    onclick="seleccionar('${asiento}', this)"
                    ${ocupado ? 'disabled' : ''}>
              ${asiento}
            </button>`;
        }
        document.getElementById("asientos").innerHTML = html;
      });

    function seleccionar(asiento, boton) {
      document.querySelectorAll(".asiento.libre").forEach(btn => btn.classList.remove("seleccionado"));
      boton.classList.add("seleccionado");
      document.getElementById("asientoSeleccionado").value = asiento;
    }

    document.getElementById("formReserva").addEventListener("submit", function(e) {
      const asiento = document.getElementById("asientoSeleccionado").value;
      const nombre = document.getElementById("nombre").value.trim();

      if (!asiento) {
        alert("Por favor selecciona un asiento disponible.");
        e.preventDefault();
      } else if (!nombre) {
        alert("Por favor ingresa tu nombre.");
        e.preventDefault();
      }
    });
  </script>
</body>
</html>
